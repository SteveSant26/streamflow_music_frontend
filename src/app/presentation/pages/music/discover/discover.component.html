<div class="discover-container" [class.dark-theme]="isDarkTheme()">
  <!-- Header -->
  <div class="discover-header">
    <h1>{{ 'HOME.TITLE' | translate }}</h1>
    <div class="flex items-center gap-2">
      <!-- View Mode Toggle -->
      <button mat-icon-button (click)="toggleViewMode()" class="text-white">
        <mat-icon>{{ viewMode() === 'grid' ? 'view_list' : viewMode() === 'table' ? 'view_module' : 'grid_view' }}</mat-icon>
      </button>
      <button mat-icon-button (click)="toggleTheme()">
        <mat-icon>{{ isDarkTheme() ? 'light_mode' : 'dark_mode' }}</mat-icon>
      </button>
    </div>
  </div>

  <!-- Albums Populares -->
  <section class="discover-section">
    <div class="section-header">
      <h2>{{ 'HOME.POPULAR_ALBUMS' | translate }}</h2>
      <button mat-button 
              color="primary" 
              routerLink="/albums"
              class="view-all-btn">
        {{ 'HOME.VIEW_ALL' | translate }}
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
    <!-- Albums Loading Skeleton -->
    <app-skeleton-group 
      *ngIf="isLoadingAlbums()" 
      [config]="albumsSkeletonConfig">
    </app-skeleton-group>
    <div class="error-message" *ngIf="albumsError()">
      {{ 'ERRORS.LOAD_ALBUMS' | translate }}: {{ albumsError() }}
    </div>
    <div class="albums-grid" *ngIf="!isLoadingAlbums() && !albumsError()">
      <mat-card *ngFor="let album of popularAlbums()" class="album-card">
        <img mat-card-image [src]="album.cover_url || '/assets/default-album.png'" 
             [alt]="album.title" class="album-cover">
        <mat-card-content>
          <h3>{{ album.title }}</h3>
          <p>{{ album.artist_name }}</p>
          <p class="album-info">{{ album.total_tracks }} canciones</p>
          <p class="release-date">{{ album.release_date | date:'MMM yyyy' }}</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" [routerLink]="['/album', album.id]">
            <mat-icon>play_arrow</mat-icon>
            Reproducir
          </button>
        </mat-card-actions>
      </mat-card>
    </div>
  </section>

  <!-- Artistas Populares -->
  <section class="discover-section">
    <div class="section-header">
      <h2>{{ 'HOME.POPULAR_ARTISTS' | translate }}</h2>
      <button mat-button 
              color="primary" 
              routerLink="/artists"
              class="view-all-btn">
        {{ 'HOME.VIEW_ALL' | translate }}
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
    <!-- Artists Loading Skeleton -->
    <app-skeleton-group 
      *ngIf="isLoadingArtists()" 
      [config]="artistsSkeletonConfig">
    </app-skeleton-group>
    <div class="error-message" *ngIf="artistsError()">
      {{ 'ERRORS.LOAD_ARTISTS' | translate }}: {{ artistsError() }}
    </div>
    <div class="artists-grid" *ngIf="!isLoadingArtists() && !artistsError()">
      <mat-card *ngFor="let artist of popularArtists()" class="artist-card">
        <img mat-card-image [src]="artist.image_url || '/assets/default-artist.png'" 
             [alt]="artist.name" class="artist-image">
        <mat-card-content>
          <h3>{{ artist.name }}
            <mat-icon *ngIf="artist.is_verified" class="verified-icon">verified</mat-icon>
          </h3>
          <p class="artist-info">{{ artist.followers_count | number }} seguidores</p>
        </mat-card-content>
        <mat-card-actions>
          <button mat-button color="primary" [routerLink]="['/artist', artist.id]">Ver Perfil</button>
        </mat-card-actions>
      </mat-card>
    </div>
  </section>

  <!-- Géneros Populares -->
  <section class="discover-section">
    <div class="section-header">
      <h2>{{ 'HOME.POPULAR_GENRES' | translate }}</h2>
      <button mat-button 
              color="primary" 
              routerLink="/genres"
              class="view-all-btn">
        {{ 'HOME.VIEW_ALL' | translate }}
        <mat-icon>arrow_forward</mat-icon>
      </button>
    </div>
    <!-- Genres Loading Skeleton -->
    <app-skeleton-group 
      *ngIf="isLoadingGenres()" 
      [config]="genresSkeletonConfig">
    </app-skeleton-group>
    <div class="error-message" *ngIf="genresError()">
      {{ 'ERRORS.LOAD_GENRES' | translate }}: {{ genresError() }}
    </div>
    <div class="genres-container" *ngIf="!isLoadingGenres() && !genresError()">
      <mat-chip-set>
        <mat-chip *ngFor="let genre of popularGenres()" 
                 [style.background-color]="genre.color || '#e0e0e0'"
                 class="genre-chip">
          {{ genre.name }}
        </mat-chip>
      </mat-chip-set>
    </div>
  </section>

  <!-- Canciones Populares -->
  <section class="discover-section">
    <app-music-section
      [title]="'HOME.POPULAR_SONGS' | translate"
      [songs]="popularSongs()"
      [loading]="isLoadingPopularSongs()"
      [type]="viewMode()"
      [primaryButton]="popularSongsPrimaryButton"
      [actionButtons]="popularSongsActionButtons"
      [emptyMessage]="'HOME.NO_POPULAR_SONGS' | translate"
      [loadingMessage]="'COMMON.LOADING' | translate"
      (songSelected)="onPopularSongSelected($event)"
      (retryLoad)="onRetryPopularSongs()"
      (addToQueueRequest)="onAddToQueue($event)"
      (addToPlaylistRequest)="onAddToPlaylist($event)"
      (addToFavoritesRequest)="onAddToFavorites($event)"
      (moreOptionsRequest)="onMoreOptions($event)"
    ></app-music-section>
  </section>

  <!-- Música Aleatoria -->
  <section class="discover-section">
    <app-music-section
      [title]="'HOME.RANDOM_SONGS' | translate"
      [songs]="randomSongs()"
      [loading]="isLoadingRandomSongs()"
      [type]="viewMode()"
      [primaryButton]="randomSongsPrimaryButton"
      [actionButtons]="randomSongsActionButtons"
      [emptyMessage]="'HOME.NO_RANDOM_SONGS' | translate"
      [loadingMessage]="'COMMON.LOADING' | translate"
      (songSelected)="onRandomSongSelected($event)"
      (retryLoad)="onRetryRandomSongs()"
      (addToQueueRequest)="onAddToQueue($event)"
      (addToPlaylistRequest)="onAddToPlaylist($event)"
      (addToFavoritesRequest)="onAddToFavorites($event)"
      (moreOptionsRequest)="onMoreOptions($event)"
    ></app-music-section>
  </section>
</div>
