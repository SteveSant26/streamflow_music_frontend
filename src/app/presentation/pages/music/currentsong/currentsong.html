<!-- Contenedor principal con gradiente continuo -->
<div
  class="main-container"
  [class.with-lyrics]="showLyricsPanel"
  [style.background]="currentSong.gradient"
  *ngIf="currentSong"
>
  <div class="reproductor-content">
    <!-- Header con botón de regreso -->
    <div class="current-song-header">
      <button (click)="goBack()" class="back-button" aria-label="Volver">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="current-song-title">Reproduciendo ahora</h1>

      <!-- Botón de letras en la esquina superior derecha -->
      <button
        (click)="toggleLyricsPanel()"
        class="lyrics-button"
        aria-label="Ver letras"
        [class.active]="showLyricsPanel"
      >
        <mat-icon>lyrics</mat-icon>
      </button>
    </div>

    <!-- Imagen de la canción -->
    <div class="song-artwork-container">
      <div class="song-artwork-wrapper">
        <img
          [src]="currentSong.cover"
          [alt]="currentSong.title"
          class="song-artwork"
          (load)="onImageLoad($event)"
          (error)="onImageError($event)"
          crossorigin="anonymous"
        />
        <!-- Efecto de vinilo giratorio cuando está reproduciendo -->
      </div>
    </div>

    <!-- Espaciador flexible -->
    <div class="flexible-spacer"></div>

    <!-- Información de la canción -->
    <div class="song-info">
      <h2 class="song-title">{{ currentSong.title }}</h2>
      <p class="song-artist">{{ currentSong.artist }}</p>
      <p class="song-album">{{ currentSong.album }}</p>
    </div>

    <!-- Barra de progreso -->
    <div class="progress-section">
      <div class="time-display">
        <span class="current-time">{{ currentSong.currentTime }}</span>
        <span class="total-time">{{ currentSong.duration }}</span>
      </div>
      <div
        onkeypress
        class="progress-bar-container"
        (click)="onProgressClick($event)"
      >
        <div class="progress-bar">
          <div
            class="progress-fill"
            [style.width.%]="currentSong.progress"
          ></div>
          <div
            class="progress-thumb"
            [style.left.%]="currentSong.progress"
          ></div>
        </div>
      </div>
    </div>

    <!-- Controles de reproducción -->
    <div class="player-controls">
      <button
        (click)="skipPrevious()"
        class="control-button secondary"
        aria-label="Canción anterior"
      >
        <mat-icon>skip_previous</mat-icon>
      </button>

      <button
        (click)="togglePlayPause()"
        class="control-button primary"
        [attr.aria-label]="currentSong.isPlaying ? 'Pausar' : 'Reproducir'"
      >
        <mat-icon *ngIf="currentSong.isPlaying">pause</mat-icon>
        <mat-icon *ngIf="!currentSong.isPlaying">play_arrow</mat-icon>
      </button>

      <button
        (click)="skipNext()"
        class="control-button secondary"
        aria-label="Siguiente canción"
      >
        <mat-icon>skip_next</mat-icon>
      </button>
    </div>

    <!-- Control de volumen -->
    <div class="volume-section">
      <div class="volume-container">
        <mat-icon class="volume-icon">volume_up</mat-icon>
        <input
          type="range"
          min="0"
          max="100"
          [value]="currentSong.volume * 100"
          (input)="onVolumeChange($event)"
          class="volume-slider"
          aria-label="Control de volumen"
        />
        <span class="volume-value"
          >{{ currentSong.volume * 100 | number: "1.0-0" }}%</span
        >
      </div>
    </div>

    <!-- Footer con información adicional -->
    <div class="song-footer">
      <div class="footer-actions">
        <button class="action-button" aria-label="Agregar a favoritos">
          <mat-icon>favorite_border</mat-icon>
        </button>
        <button class="action-button" aria-label="Compartir">
          <mat-icon>share</mat-icon>
        </button>
        <button class="action-button" aria-label="Más opciones">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Panel de letras deslizante -->
  <div class="lyrics-panel">
    <div class="lyrics-header">
      <h3>Lyrics:</h3>
      <button
        (click)="toggleLyricsPanel()"
        class="close-lyrics-button"
        aria-label="Cerrar letras"
      >
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="lyrics-content">
      <div class="lyrics-text">
        <p class="lyrics-line active">City's breaking down on a camel's back</p>
        <p class="lyrics-line">
          They just have to go, 'cause they don't know wack
        </p>
        <p class="lyrics-line">
          So while you fill the streets, it's appealing to see
        </p>
        <p class="lyrics-line">
          You won't get out the county, 'cause you're bad and free
        </p>
        <p class="lyrics-line">
          You've got a new horizon, it's ephemeral style
        </p>
        <p class="lyrics-line">A melancholy town where we never smile</p>
        <p class="lyrics-line">And all I wanna hear is the message beep</p>
        <p class="lyrics-line">My dreams, they got a kissing</p>
        <p class="lyrics-line">'Cause I don't get sleep, no</p>

        <p class="lyrics-line chorus">Windmill, windmill for the land</p>
        <p class="lyrics-line chorus">Turn forever, hand in hand</p>
        <p class="lyrics-line chorus">Take it all in on your stride</p>
        <p class="lyrics-line chorus">It is ticking, falling down</p>
        <p class="lyrics-line chorus">Love forever, love has freely</p>
        <p class="lyrics-line chorus">Turned forever, you and me</p>
        <p class="lyrics-line chorus">Windmill, windmill for the land</p>
        <p class="lyrics-line chorus">Is everybody in?</p>

        <p class="lyrics-line">Laughing gas these hazmats, fast cats</p>
        <p class="lyrics-line">Lining 'em up like ass cracks</p>
        <p class="lyrics-line">Play these ponies at the track</p>
        <p class="lyrics-line">It's my chocolate attack</p>
        <p class="lyrics-line">
          Shit, I'm stepping in the heart of this here (yeah)
        </p>
        <p class="lyrics-line">Care Bear rappin' in harder this year (yeah)</p>
        <p class="lyrics-line">Watch me as I gravitate, ha-ha-ha-ha-ha</p>
      </div>
    </div>
  </div>
</div>

<!-- Vista de carga si no hay canción -->
<div *ngIf="!currentSong" class="loading-container">
  <div class="loading-content">
    <div class="loading-spinner"></div>
    <p>Cargando canción...</p>
  </div>
</div>
