<div class="music-section mb-8">
  <!-- Header -->
  <div class="flex items-center justify-between mb-6">
    <h2 class="text-2xl sm:text-3xl font-bold text-white flex items-center gap-2">
      @if (titleIcon) {
        <span>{{ titleIcon }}</span>
      }
      {{ title }}
    </h2>
    
    <div class="flex items-center gap-2">
      <!-- Primary button (like "Ver todas") -->
      @if (primaryButton) {
        <button 
          class="text-black hover:text-gray-700 text-sm font-medium"
          (click)="primaryButton.action()"
          [attr.aria-label]="primaryButton.ariaLabel"
        >
          {{ primaryButton.text }}
        </button>
      }
      
      <!-- Action buttons (like refresh, play) -->
      @for (button of actionButtons; track $index) {
        <button 
          class="p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors"
          (click)="button.action()"
          [attr.aria-label]="button.ariaLabel"
        >
          <mat-icon class="text-white text-base">{{ button.icon }}</mat-icon>
        </button>
      }
    </div>
  </div>
  
  <!-- Loading state -->
  <div *ngIf="loading" class="flex justify-center items-center py-8">
    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-white"></div>
    @if (loadingMessage) {
      <span class="ml-3 text-white">{{ loadingMessage }}</span>
    }
  </div>
  
  <!-- Content based on type -->
  <!-- DEBUG: MusicSection type = {{ type }} -->
  @if (!loading && songs.length > 0) {
    <!-- Grid layout for songs (como cards de discover) -->
    @if (type === 'grid') {
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4 sm:gap-6">
        @for (song of songs; track song.id) {
          <div class="song-card bg-white rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 overflow-hidden group">
            <!-- Imagen con overlay de botones -->
            <div class="relative bg-gray-200 rounded-t-lg overflow-hidden aspect-square">
              <img
                [src]="song.thumbnail_url || 'assets/images/default-album.jpg'"
                [alt]="song.title"
                class="w-full h-full object-cover"
                appImageFallback="assets/images/default-album.jpg"
                loading="lazy"
              />
              <!-- Overlay con botón de play -->
              <div class="absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-300 flex items-center justify-center">
                <button
                  (click)="onSongClick(song); $event.stopPropagation()"
                  class="play-overlay-btn opacity-0 group-hover:opacity-100 bg-green-500 hover:bg-green-600 text-white w-16 h-16 rounded-full flex items-center justify-center transition-all duration-300 transform scale-75 group-hover:scale-100 shadow-xl z-10"
                  [attr.aria-label]="'Reproducir ' + song.title"
                  type="button"
                >
                  <mat-icon class="text-3xl">play_arrow</mat-icon>
                </button>
              </div>
            </div>
            
            <!-- Información de la canción -->
            <div class="p-4">
              <h3 class="font-semibold text-gray-900 text-sm truncate mb-1">{{ song.title }}</h3>
              <p class="text-gray-600 text-xs truncate mb-2">{{ song.artist_name || 'Artista desconocido' }}</p>
              
              @if (showPlayCount && song.play_count) {
                <div class="flex items-center text-xs text-gray-500 mb-3">
                  <mat-icon class="w-3 h-3 mr-1">play_arrow</mat-icon>
                  <span>{{ formatPlayCount(song.play_count) }} plays</span>
                </div>
              }
              
              <!-- Botones de acción usando SongActionButtonComponent -->
              <div class="flex items-center justify-between">
                <app-song-action-button
                  [song]="song"
                  [showQuickPlay]="false"
                  size="small"
                ></app-song-action-button>
              </div>
            </div>
          </div>
        }
      </div>
    }
    
    <!-- Table layout for songs -->
    @if (type === 'table') {
      <div class="mt-4">
        <app-musics-table [songs]="songs"></app-musics-table>
      </div>
    }

    <!-- List layout for songs (como en search) -->
    @if (type === 'list') {
      <div class="space-y-3">
        @for (song of songs; track song.id; let i = $index) {
          <div class="song-card bg-white rounded-lg p-4 shadow-sm border border-gray-200 hover:shadow-md transition-all duration-200 flex items-center gap-4">
            <!-- Número de posición -->
            <div class="song-number text-gray-400 font-mono text-sm w-8 text-center">
              {{ i + 1 }}
            </div>

            <!-- Imagen de la canción -->
            <div class="song-image w-16 h-16 rounded-lg overflow-hidden bg-gray-200 flex-shrink-0 flex items-center justify-center">
              <img 
                [src]="song.thumbnail_url || 'assets/images/default-album.jpg'" 
                [alt]="song.title + ' - ' + song.artist_name"
                class="w-full h-full object-cover"
                appImageFallback="assets/images/default-album.jpg"
                loading="lazy"
              />
            </div>

            <!-- Botón de reproducción individual -->
            <button
              (click)="onSongClick(song); $event.stopPropagation()"
              class="play-btn bg-green-500 hover:bg-green-600 text-white w-12 h-12 rounded-full flex items-center justify-center transition-all duration-200 hover:scale-110 shadow-md z-10"
              [attr.aria-label]="'Reproducir ' + song.title"
              type="button"
            >
              <mat-icon class="text-xl">play_arrow</mat-icon>
            </button>

            <!-- Información de la canción -->
            <div class="song-info flex-1 min-w-0">
              <h4 class="font-semibold text-gray-900 truncate">{{ song.title }}</h4>
              <p class="text-gray-600 text-sm truncate">{{ song.artist_name || 'Artista desconocido' }}</p>
              <div class="flex items-center gap-2 text-xs text-gray-500 mt-1">
                <span *ngIf="song.album_name" class="truncate">{{ song.album_name }}</span>
                <span *ngIf="song.duration_formatted">• {{ song.duration_formatted }}</span>
                @if (showPlayCount && song.play_count) {
                  <span>• {{ formatPlayCount(song.play_count) }} plays</span>
                }
              </div>
            </div>

            <!-- Acciones adicionales -->
            <div class="song-actions flex items-center gap-2">
              <app-song-action-button
                [song]="song"
                [showQuickPlay]="false"
                size="medium"
              ></app-song-action-button>
            </div>
          </div>
        }
      </div>
    }
  }
  
  <!-- Empty state -->
  @if (!loading && songs.length === 0) {
    <div class="text-center py-8">
      <mat-icon class="text-gray-400 text-4xl mb-2">music_note</mat-icon>
      <p class="text-gray-400">{{ emptyMessage }}</p>
      <button 
        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
        (click)="onRetryClick()"
      >
        Reintentar
      </button>
    </div>
  }
</div>
