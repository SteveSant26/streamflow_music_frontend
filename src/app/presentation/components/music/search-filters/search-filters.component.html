<div class="search-filters">
  <div class="filters-header">
    <h3 class="filters-title">
      <mat-icon>tune</mat-icon>
      {{ 'SEARCH.ADVANCED_FILTERS' | translate }}
      <span 
        *ngIf="hasActiveFilters()" 
        class="active-count"
        [matBadge]="getActiveFiltersCount()"
        matBadgeColor="primary"
        matBadgeSize="small"
      ></span>
    </h3>
    
    <button 
      mat-button 
      color="warn" 
      (click)="clearFilters()"
      *ngIf="hasActiveFilters()"
      class="clear-button"
    >
      <mat-icon>clear_all</mat-icon>
      {{ 'SEARCH.CLEAR_FILTERS' | translate }}
    </button>
  </div>

  <mat-accordion class="filters-accordion">
    <mat-expansion-panel 
      *ngFor="let group of filterGroups(); trackBy: trackByGroupId"
      [expanded]="group.expanded"
      (opened)="toggleGroup(group.id, true)"
      (closed)="toggleGroup(group.id, false)"
      class="filter-group"
    >
      <mat-expansion-panel-header>
        <mat-panel-title>
          <mat-icon>{{ group.icon }}</mat-icon>
          {{ group.name }}
          <span 
            *ngIf="getGroupActiveFiltersCount(group) > 0" 
            class="group-badge"
            [matBadge]="getGroupActiveFiltersCount(group)"
            matBadgeColor="accent"
            matBadgeSize="small"
          ></span>
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="filter-content">
        <div 
          *ngFor="let filter of group.filters; trackBy: trackByFilterId" 
          class="filter-item"
        >
          <!-- Text Input -->
          <mat-form-field 
            *ngIf="filter.type === 'text'" 
            appearance="outline"
            class="full-width"
          >
            <mat-label>{{ filter.name }}</mat-label>
            <input 
              matInput 
              [placeholder]="filter.placeholder || ''"
              [value]="filter.value || ''"
              (input)="updateFilter(group.id, filter.id, $event)"
            >
            <mat-icon matSuffix>search</mat-icon>
          </mat-form-field>

          <!-- Select -->
          <mat-form-field 
            *ngIf="filter.type === 'select'" 
            appearance="outline"
            class="full-width"
          >
            <mat-label>{{ filter.name }}</mat-label>
            <mat-select 
              [value]="filter.value || ''"
              (valueChange)="updateFilterValue(group.id, filter.id, $event)"
            >
              <mat-option 
                *ngFor="let option of filter.options" 
                [value]="option.value"
              >
                {{ option.label }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Range -->
          <div *ngIf="filter.type === 'range'" class="range-filter">
            <label class="range-label" >{{ filter.name }}</label>
            <input 
              type="range" 
              [min]="filter.min || 0" 
              [max]="filter.max || 100"
              [step]="1"
              [value]="filter.value || filter.min || 0"
              (input)="updateFilter(group.id, filter.id, $event)"
              class="range-input"
            >
            <div class="range-value">
              Valor: {{ filter.value || filter.min || 0 }}
              <span *ngIf="filter.id.includes('duration')">
                ({{ formatDuration(filter.value || 0) }})
              </span>
            </div>
          </div>

          <!-- Boolean -->
          <div *ngIf="filter.type === 'boolean'" class="boolean-filter">
            <mat-checkbox 
              [checked]="filter.value || false"
              (change)="updateFilterValue(group.id, filter.id, $event.checked)"
            >
              {{ filter.name }}
            </mat-checkbox>
          </div>
        </div>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
